HW3, Onyeka Isamah
================

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──

    ## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
    ## ✓ tibble  3.1.4     ✓ dplyr   1.0.7
    ## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
    ## ✓ readr   2.0.1     ✓ forcats 0.5.1

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(p8105.datasets)
```

# Problem 1:

The data set instacart has 1384617 rows and 15 columns which include
`order_id`, `product_id`, `add_to_cart_order`, `reordered user_id`,
`eval_set`, `order_number`, `order_dow`, `order_hour_of_day`,
`days_since_prior_order`, `product_name`, `aisle_id`, `department_id`,
`aisle`, and `departmemt`. There are 134 aisles, the three top aisles
that most products are order from include fresh fruits aisle (18726
bananas, ranked \#1 in fresh fruit category), the packaged vegetable
fruits aisle(Organic Baby Spiniach n = 9784 and ranked as \#1 product
within that aisle) and the milk aisle (organic whole milk n=4908).

``` r
data("instacart")
janitor::clean_names(instacart)
```

    ## # A tibble: 1,384,617 × 15
    ##    order_id product_id add_to_cart_order reordered user_id eval_set order_number
    ##       <int>      <int>             <int>     <int>   <int> <chr>           <int>
    ##  1        1      49302                 1         1  112108 train               4
    ##  2        1      11109                 2         1  112108 train               4
    ##  3        1      10246                 3         0  112108 train               4
    ##  4        1      49683                 4         0  112108 train               4
    ##  5        1      43633                 5         1  112108 train               4
    ##  6        1      13176                 6         0  112108 train               4
    ##  7        1      47209                 7         0  112108 train               4
    ##  8        1      22035                 8         1  112108 train               4
    ##  9       36      39612                 1         0   79431 train              23
    ## 10       36      19660                 2         1   79431 train              23
    ## # … with 1,384,607 more rows, and 8 more variables: order_dow <int>,
    ## #   order_hour_of_day <int>, days_since_prior_order <int>, product_name <chr>,
    ## #   aisle_id <int>, department_id <int>, aisle <chr>, department <chr>

``` r
max(instacart$aisle_id)
```

    ## [1] 134

``` r
top_products_by_aisle_df= instacart %>% select(
         everything()) %>% 
  group_by(aisle, department) %>% 
  count(
    product_name, name = "product_count") %>% 
  mutate(product_rank = min_rank(desc(product_count)))%>% 
 
   filter(product_rank <= 3)  %>% 
  arrange(product_rank) %>% arrange(desc(product_count)) 


top_products_by_aisle_df
```

    ## # A tibble: 406 × 5
    ## # Groups:   aisle, department [134]
    ##    aisle                      department product_name product_count product_rank
    ##    <chr>                      <chr>      <chr>                <int>        <int>
    ##  1 fresh fruits               produce    Banana               18726            1
    ##  2 fresh fruits               produce    Bag of Orga…         15480            2
    ##  3 fresh fruits               produce    Organic Str…         10894            3
    ##  4 packaged vegetables fruits produce    Organic Bab…          9784            1
    ##  5 packaged vegetables fruits produce    Organic Ras…          5546            2
    ##  6 packaged vegetables fruits produce    Organic Blu…          4966            3
    ##  7 milk                       dairy eggs Organic Who…          4908            1
    ##  8 fresh vegetables           produce    Organic Cuc…          4613            1
    ##  9 fresh vegetables           produce    Organic Zuc…          4589            2
    ## 10 fresh vegetables           produce    Organic Yel…          4290            3
    ## # … with 396 more rows

Plotting top products by aisle where product count &gt; 10000

``` r
top_products_by_aisle_df %>% 
filter(product_count >= 10000) %>% 
  ggplot(aes(x= product_name, y=product_count)) + geom_point(aes(color= aisle))
```

![](oi2142_HW3_files/figure-gfm/top%20products%20plot-1.png)<!-- -->

Table showing the three most popular items in each of the aisles “baking
ingredients”, “dog food care”, and “packaged vegetables fruits”.

``` r
pop3_df= (select(
  instacart, order_number, aisle,product_name) %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  
  group_by(aisle) %>% 
  count(
    product_name, name = "product_count") %>% 
    
  mutate(product_rank = min_rank(desc(product_count))) %>% 
    
   filter(product_rank <= 3)  %>% 
    
  arrange(product_rank) %>% arrange(desc(product_count)))

pop3_df
```

    ## # A tibble: 9 × 4
    ## # Groups:   aisle [3]
    ##   aisle                      product_name             product_count product_rank
    ##   <chr>                      <chr>                            <int>        <int>
    ## 1 packaged vegetables fruits Organic Baby Spinach              9784            1
    ## 2 packaged vegetables fruits Organic Raspberries               5546            2
    ## 3 packaged vegetables fruits Organic Blueberries               4966            3
    ## 4 baking ingredients         Light Brown Sugar                  499            1
    ## 5 baking ingredients         Pure Baking Soda                   387            2
    ## 6 baking ingredients         Cane Sugar                         336            3
    ## 7 dog food care              Snack Sticks Chicken & …            30            1
    ## 8 dog food care              Organix Chicken & Brown…            28            2
    ## 9 dog food care              Small Dog Biscuits                  26            3

Make a table showing the mean hour of the day at which Pink Lady Apples
and Coffee Ice Cream are ordered on each day of the week; format this
table for human readers (i.e. produce a 2 x 7 table).

``` r
mean_hod = instacart %>% drop_na() %>% 
  select(product_name,order_hour_of_day, order_dow)  %>% 
 mutate(
    
    order_dow = 
      recode_factor(order_dow,
        "0" = "Sunday", "1" = "Monday", "2" = "Tuesday", "3" = "Wednesday", "4"= "Thursday", "5" = "Friday", "6" = "Saturday")) %>% 
  group_by(product_name, order_dow) %>% 
  summarise(meanhour = mean(order_hour_of_day)) %>% 
filter(product_name %in% c( "Pink Lady Apples", "Coffee Ice Cream")) %>% 
  pivot_wider(names_from = order_dow,  values_from = meanhour) 
```

    ## `summarise()` has grouped output by 'product_name'. You can override using the `.groups` argument.

``` r
mean_hod
```

    ## # A tibble: 2 × 8
    ## # Groups:   product_name [2]
    ##   product_name     Sunday Monday Tuesday Wednesday Thursday Friday Saturday
    ##   <chr>             <dbl>  <dbl>   <dbl>     <dbl>    <dbl>  <dbl>    <dbl>
    ## 1 Coffee Ice Cream   13.8   14.3    15.4      15.3     15.2   12.3     13.8
    ## 2 Pink Lady Apples   13.4   11.4    11.7      14.2     11.6   12.8     11.9

\#Problem 2

``` r
library(p8105.datasets)
data("brfss_smart2010")

brfss_smart2010
```

    ## # A tibble: 134,203 × 23
    ##     Year Locationabbr Locationdesc  Class  Topic Question   Response Sample_Size
    ##    <int> <chr>        <chr>         <chr>  <chr> <chr>      <chr>          <int>
    ##  1  2010 AL           AL - Jeffers… Healt… Over… How is yo… Excelle…          94
    ##  2  2010 AL           AL - Jeffers… Healt… Over… How is yo… Very go…         148
    ##  3  2010 AL           AL - Jeffers… Healt… Over… How is yo… Good             208
    ##  4  2010 AL           AL - Jeffers… Healt… Over… How is yo… Fair             107
    ##  5  2010 AL           AL - Jeffers… Healt… Over… How is yo… Poor              45
    ##  6  2010 AL           AL - Jeffers… Healt… Fair… Health St… Good or…         450
    ##  7  2010 AL           AL - Jeffers… Healt… Fair… Health St… Fair or…         152
    ##  8  2010 AL           AL - Jeffers… Healt… Heal… Do you ha… Yes              524
    ##  9  2010 AL           AL - Jeffers… Healt… Heal… Do you ha… No                77
    ## 10  2010 AL           AL - Jeffers… Healt… Unde… Adults ag… Yes              316
    ## # … with 134,193 more rows, and 15 more variables: Data_value <dbl>,
    ## #   Confidence_limit_Low <dbl>, Confidence_limit_High <dbl>,
    ## #   Display_order <int>, Data_value_unit <chr>, Data_value_type <chr>,
    ## #   Data_Value_Footnote_Symbol <chr>, Data_Value_Footnote <chr>,
    ## #   DataSource <chr>, ClassId <chr>, TopicId <chr>, LocationID <chr>,
    ## #   QuestionID <chr>, RESPID <chr>, GeoLocation <chr>

``` r
newbrfss_df <- brfss_smart2010 %>% separate(Locationdesc,into = c ("state", "County")) %>% 
select(Response, Topic, everything()) %>% 
  mutate(Response = factor(Response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent"))) %>% 
  filter(Topic == "Overall Health") %>% janitor::clean_names() 
```

    ## Warning: Expected 2 pieces. Additional pieces discarded in 134203 rows [1, 2, 3,
    ## 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].

``` r
newbrfss_df
```

    ## # A tibble: 10,625 × 24
    ##    response  topic           year locationabbr state county class question sample_size
    ##    <fct>     <chr>          <int> <chr>        <chr> <chr>  <chr> <chr>          <int>
    ##  1 Excellent Overall Health  2010 AL           AL    Jeffe… Heal… How is …          94
    ##  2 Very good Overall Health  2010 AL           AL    Jeffe… Heal… How is …         148
    ##  3 Good      Overall Health  2010 AL           AL    Jeffe… Heal… How is …         208
    ##  4 Fair      Overall Health  2010 AL           AL    Jeffe… Heal… How is …         107
    ##  5 Poor      Overall Health  2010 AL           AL    Jeffe… Heal… How is …          45
    ##  6 Excellent Overall Health  2010 AL           AL    Mobile Heal… How is …          91
    ##  7 Very good Overall Health  2010 AL           AL    Mobile Heal… How is …         177
    ##  8 Good      Overall Health  2010 AL           AL    Mobile Heal… How is …         224
    ##  9 Fair      Overall Health  2010 AL           AL    Mobile Heal… How is …         120
    ## 10 Poor      Overall Health  2010 AL           AL    Mobile Heal… How is …          66
    ## # … with 10,615 more rows, and 15 more variables: data_value <dbl>,
    ## #   confidence_limit_low <dbl>, confidence_limit_high <dbl>,
    ## #   display_order <int>, data_value_unit <chr>, data_value_type <chr>,
    ## #   data_value_footnote_symbol <chr>, data_value_footnote <chr>,
    ## #   data_source <chr>, class_id <chr>, topic_id <chr>, location_id <chr>,
    ## #   question_id <chr>, respid <chr>, geo_location <chr>

\#In 2002, which states were observed at 7 or more locations? 5 states

``` r
brfss2002 = newbrfss_df %>% 
  filter(year =="2002") %>% 
  group_by(state) %>% 
  distinct(county) %>% 
  count(state) %>% 
  filter(n>=7) %>% 
  select(state)
brfss2002
```

    ## # A tibble: 5 × 1
    ## # Groups:   state [5]
    ##   state
    ##   <chr>
    ## 1 FL   
    ## 2 MA   
    ## 3 NC   
    ## 4 NJ   
    ## 5 PA

14 states in 2010

``` r
brfss2010 = newbrfss_df %>% 
  filter(year =="2010") %>% 
  group_by(state) %>% 
  distinct(county) %>% 
  count(state) %>% 
  filter(n>=7) %>% 
  select(state)
brfss2010
```

    ## # A tibble: 14 × 1
    ## # Groups:   state [14]
    ##    state
    ##    <chr>
    ##  1 CA   
    ##  2 CO   
    ##  3 FL   
    ##  4 MA   
    ##  5 MD   
    ##  6 NC   
    ##  7 NE   
    ##  8 NJ   
    ##  9 NY   
    ## 10 OH   
    ## 11 PA   
    ## 12 SC   
    ## 13 TX   
    ## 14 WA

Construct a dataset that is limited to Excellent responses, and
contains, year, state, and a variable that averages the data\_value
across locations within a state. Make a “spaghetti” plot of this average
value over time within a state (that is, make a plot showing a line for
each state across years

``` r
newbrfss_df %>% 
  select(year, locationabbr, response, data_value, geo_location) %>% 
  filter(response == "Excellent") %>% 
  group_by(locationabbr,year) %>% 
  mutate(avg_data = mean(data_value)) %>% 
  select(year, locationabbr, avg_data) %>% 
  
  
  ggplot(aes(x=year, y = avg_data, color= locationabbr)) + 
  geom_line() + theme(legend.position = "right") 
```

    ## Warning: Removed 65 row(s) containing missing values (geom_path).

![](oi2142_HW3_files/figure-gfm/Excellent%20dataset%20and%20plot-1.png)<!-- -->

Make a two-panel plot showing, for the years 2006, and 2010,
distribution of data\_value for responses (“Poor” to “Excellent”) among
locations in NY State.

``` r
facetbrfss <- brfss_smart2010 %>% 
select(Response, Topic, everything()) %>% 
  mutate(Response = factor(Response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent"))) %>% 
  filter(Topic == "Overall Health") %>% janitor::clean_names() 
newbrfss_df
```

    ## # A tibble: 10,625 × 24
    ##    response  topic           year locationabbr state county class question sample_size
    ##    <fct>     <chr>          <int> <chr>        <chr> <chr>  <chr> <chr>          <int>
    ##  1 Excellent Overall Health  2010 AL           AL    Jeffe… Heal… How is …          94
    ##  2 Very good Overall Health  2010 AL           AL    Jeffe… Heal… How is …         148
    ##  3 Good      Overall Health  2010 AL           AL    Jeffe… Heal… How is …         208
    ##  4 Fair      Overall Health  2010 AL           AL    Jeffe… Heal… How is …         107
    ##  5 Poor      Overall Health  2010 AL           AL    Jeffe… Heal… How is …          45
    ##  6 Excellent Overall Health  2010 AL           AL    Mobile Heal… How is …          91
    ##  7 Very good Overall Health  2010 AL           AL    Mobile Heal… How is …         177
    ##  8 Good      Overall Health  2010 AL           AL    Mobile Heal… How is …         224
    ##  9 Fair      Overall Health  2010 AL           AL    Mobile Heal… How is …         120
    ## 10 Poor      Overall Health  2010 AL           AL    Mobile Heal… How is …          66
    ## # … with 10,615 more rows, and 15 more variables: data_value <dbl>,
    ## #   confidence_limit_low <dbl>, confidence_limit_high <dbl>,
    ## #   display_order <int>, data_value_unit <chr>, data_value_type <chr>,
    ## #   data_value_footnote_symbol <chr>, data_value_footnote <chr>,
    ## #   data_source <chr>, class_id <chr>, topic_id <chr>, location_id <chr>,
    ## #   question_id <chr>, respid <chr>, geo_location <chr>

``` r
facetbrfss%>% 
  filter(locationabbr == "NY", year %in% c("2006", "2010")) %>% 
  group_by(year,locationdesc) %>% 
  ggplot(aes(x=response, y = data_value, group = locationdesc, color =locationdesc))+ geom_line()+facet_grid(.~year)
```

![](oi2142_HW3_files/figure-gfm/facet%20NY-1.png)<!-- -->
